# Copyright (c) 2021 Andrew Archibald
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

# Exp tests borrowed from Go
# https://golang.org/src/math/big/int_test.go#L527

call 0    0          test_exp
call 1    0          test_exp
call -10  0          test_exp
call 1234 -1         test_exp
call 1234 -1    0    test_modexp
call 17   -100  1234 test_modexp
call 2    -100  1234 test_modexp
call 0    0     1    test_modexp
call 1    0     1    test_modexp
call -10  0     1    test_modexp
call 1234 -1    1    test_modexp
call 5    1     3    test_modexp
call 5    -7         test_exp
call -5   -7         test_exp
call 5    0          test_exp
call -5   0          test_exp
call 5    1          test_exp
call -5   1          test_exp
call -5   1     7    test_modexp
call -2   3     2    test_modexp
call 5    2          test_exp
call 1    65537 2    test_modexp

call 9223372036854775808 2             test_exp
call 9223372036854775808 2        6719 test_modexp
call 9223372036854775808 3        6719 test_modexp
call 9223372036854775808 1000     6719 test_modexp
call 9223372036854775808 1000000  6719 test_modexp
call 9223372036854775808 -1000000 6719 test_modexp

push 340282366920938463463374607431768211455
push 1662864082237195566310326201168373022015780906889
push 1418189353909770683508028082434312329
call test_modexp

push 2938462938472983472983659726349017249287491026512746239764525612965293865296239471239874193284792387498274256129746192347
push 298472983472983471903246121093472394872319615612417471234712061
push 29834729834729834729347290846729561262544958723956495615629569234729836259263598127342374289365912465901365498236492183464
call test_modexp

push 11001289118363089646017359372117963499250546375269047542777928006103246876688756735760905680604646624353196869572752623285140408755420374049317646428185270079555372763503115646054602867593662923894140940837479507194934267532831694565516466765025434902348314525627418515646588160955862839022051353653052947073136084780742729727874803457643848197499548297570026926927502505634297079527299004267769780768565695459945235586892627059178884998772989397505061206395455591503771677500931269477503508150175717121828518985901959919560700853226255420793148986854391552859459511723547532575574664944815966793196961286234040892865
push 9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
push 21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
call test_modexp

push -406433107806066117724671127918333319356292137541743435963950056078916830599029304840314096986266415209224657355837736572200922261163426578651179331131393453988793860237218377235310492383052991190710496340935141634222043093630918151355287758455407438574603857807197323193543796704282457632629182117985956027344756573721567514880098048276151534703676759064670659469188726096428997021371814351238905656170764301138971404583017383454598548551490083189000750931917501000103588820172353162181746970031885719255647656318788280042451109911548051099338702770999665507389439368204693523628612571814083081853523955169312343114509112104365057376126477933949472021889879434438295890522570919854239271657682
push 9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
push 21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
call test_modexp

push 18446744069414584321
push 18446744069414584321
push 18446744069414584321
call test_modexp

push 79228162514264337589248983041
push 79228162514264337589248983041
push 79228162514264337589248983041
call test_modexp

push 340282366920938463463374607427473244161
push 340282366920938463463374607427473244161
push 340282366920938463463374607427473244161
call test_modexp

push 1461501637330902918203684832716283019651637575681
push 1461501637330902918203684832716283019651637575681
push 1461501637330902918203684832716283019651637575681
call test_modexp

push 2
push 9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
push 21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
call test_modexp

push 2
push 9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
push 21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288818
call test_modexp

end

test_exp:
    push -1
    push '\n'
    copy 3 copy 3 call exp push -2
    push ' ' push '=' push ' '
    copy 7 push -2
    push ' ' push '*' push '*' push ' '
    copy 14 push -2
    call printf
    drop 2
    ret

test_modexp:
    push -1
    push '\n' push ')'
    copy 3 push -2
    push ' ' push 'd' push 'o' push 'm' push '(' push ' '
    copy 13 copy 13 copy 13 call modexp push -2
    push ' ' push '=' push ' '
    copy 17 push -2
    push ' ' push '*' push '*' push ' '
    copy 24 push -2
    call printf
    drop 3
    ret
